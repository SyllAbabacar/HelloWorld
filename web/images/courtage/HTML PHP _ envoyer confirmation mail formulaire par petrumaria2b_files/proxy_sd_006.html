<!DOCTYPE html>
<!-- saved from url=(0052)https://k8t3w3m6.ssl.hwcdn.net/v6/11/12/coupons.html -->
<html class=" chrome-55"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>brappui Bar</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./main.css">
</head>
<body>
    <div class="brappuicoupons" style="display:none">
         <div class="brappuicoupons__logo"></div>
        <div class="brappuicoupons__count">
        </div>
    </div>

    <script src="./app.js.téléchargement"></script>
    <script type="text/javascript">
        // provides simple time functions
        brappui.time = {
            stamp: function() {
                var d = new Date();
                return d.getTime();
            },
            string: function(timestamp) {
                var d = new Date();
                if (timestamp) {
                    d.setTime(timestamp);
                }
                return d.toDateString();
            },
            past4am: function() {
                var d = new Date();
                var h = d.getHours();
                return (h - 4) > 0;
            },
            dayPassed: function(timestamp) {
                return brappui.time.string() !== brappui.time.string(timestamp);
            }
        };

        // provides simple storage methods
        brappui.storage = {
            get: function(key, defaultValue) {
                if (localStorage[key]) {
                    try {
                        return JSON.parse(localStorage[key]);
                    } catch (ex) {

                    }
                }
                if (defaultValue === undefined) {
                    return null;
                }
                return defaultValue;
            },
            set: function(key, newValue) {
                localStorage[key] = JSON.stringify(newValue);
            },
            remove: function(key) {
                if (localStorage[key]) {
                    delete localStorage[key];
                }
            }
        };

        // manages ajax request attempts
        brappui.shouldAttempt = function(id) {
            var attemptID = 'attempt_' + id;
            var lastAttempt = brappui.storage.get(attemptID, null);

            if (lastAttempt === null) {
                brappui.storage.set(attemptID, brappui.time.stamp());
                return true;
            }

            var attempt = false;


            if (brappui.time.dayPassed(lastAttempt)) {
                if (brappui.time.past4am()) {
                    attempt = true;
                }
            }

            if (attempt === true) {
                brappui.storage.set(attemptID, brappui.time.stamp());
            }
            return attempt;
        };

        var storedCouponsObj = brappui.storage.get('couponsInExt', {
            domain: null,
            coupon: null
        });

        brappui.main.addEventListener(
          document.querySelector('.brappuicoupons'),
          'click',
          function() {
              brappui.main.fireEvent('launchCoupons', {
                  couponsData: window.couponsData
              });
          }
        );

        brappui.main.addEventListener(
          window,
          'message',
          function(evt) {
              var data = null;
        
        try {
            data = JSON.parse(evt.data);
        } catch(e){};

        if (!data || !data.event) {
        return;
		}
              window.count = data.count;
              window.domain = data.domain;

              if (storedCouponsObj.domain == window.domain) {
                  brappui.main.fireEvent('launchBigCouponsBar', {
                      coupon: storedCouponsObj.coupon
                  });
                  brappui.storage.remove('couponsInExt');
              } else {
                  var displayFull = brappui.shouldAttempt('c_' + window.domain);
                  if (displayFull) {
                      brappui.main.fireEvent('launchCoupons', {
                          couponsData: window.couponsData
                      });
                  }

                  document.querySelector('.brappuicoupons__count').innerHTML = data.count;
                  document.querySelector('.brappuicoupons').style.display = "block";
              }
          }
        )
    </script>


</body></html>